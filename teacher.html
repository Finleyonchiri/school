<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Teacher Portal - BORABU TTC</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
    }
    .container {
      display: flex;
      min-height: 100vh;
    }
    .sidebar {
      width: 250px;
      background: linear-gradient(to bottom, #6b48ff, #ff6f61);
      color: #fff;
      padding: 20px;
      box-shadow: 5px 0 15px rgba(0, 0, 0, 0.1);
      position: relative;
    }
    .sidebar .profile {
      text-align: center;
      margin-bottom: 30px;
    }
    .sidebar .profile img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      border: 3px solid #ffd700;
      margin-bottom: 10px;
    }
    .sidebar h2 {
      font-size: 24px;
      margin-bottom: 30px;
      text-align: center;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
    }
    .sidebar a, .sidebar button {
      display: block;
      color: #fff;
      padding: 15px;
      text-decoration: none;
      background: rgba(255, 255, 255, 0.1);
      margin-bottom: 10px;
      border-radius: 8px;
      font-size: 16px;
      text-align: center;
      transition: background 0.3s;
    }
    .sidebar a:hover, .sidebar button:hover {
      background: rgba(255, 255, 255, 0.3);
    }
    .main-content {
      flex: 1;
      padding: 30px;
    }
    .section {
      display: none;
      background: #fff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
    }
    .section.active {
      display: block;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: left;
    }
    th {
      background: #6b48ff;
      color: #fff;
    }
    tr:nth-child(even) {
      background: #f9f9f9;
    }
    select, input, textarea {
      width: 100%;
      padding: 12px;
      margin-bottom: 20px;
      border: 2px solid #ccc;
      border-radius: 8px;
      box-sizing: border-box;
      font-size: 16px;
    }
    button {
      padding: 12px;
      background: linear-gradient(to right, #ff6f61, #ff9f61);
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover {
      background: linear-gradient(to right, #ff9f61, #ff6f61);
    }
    .edit-btn {
      padding: 8px;
      background: #6b48ff;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .edit-btn:hover {
      background: #5a3de6;
    }
    .error-message {
      color: #ff4444;
      font-size: 16px;
      margin: 20px 0;
    }
    .success-message {
      color: #00cc00;
      font-size: 16px;
      margin: 20px 0;
    }
    .checkbox-label {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    .checkbox-label input {
      width: auto;
      margin-right: 10px;
    }
    .loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .loading-screen.hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="loading-screen" id="loadingScreen">
    <div>Loading...</div>
  </div>
  <div class="container">
    <div class="sidebar">
      <div class="profile">
        <img src="https://img.icons8.com/color/80/000000/teacher.png" alt="Teacher Icon">
        <p id="teacherName"></p>
      </div>
      <h2>Teacher Portal</h2>
      <a href="#" onclick="showSection('students')">Students</a>
      <a href="#" onclick="showSection('addStudent')">Add Student</a>
      <a href="#" onclick="showSection('marks')">Upload Marks</a>
      <a href="#" onclick="showSection('announcements')">Announcements</a>
      <button onclick="logout()">Logout</button>
    </div>
    <div class="main-content">
      <div id="students" class="section active">
        <h1 style="font-size: 28px; color: #333;">Students</h1>
        <select id="formSelect" onchange="loadStudents()">
          <option value="form1">Form 1</option>
          <option value="form2">Form 2</option>
          <option value="form3">Form 3</option>
          <option value="form4">Form 4</option>
        </select>
        <div id="studentsMessage" class="error-message"></div>
        <table id="studentsTable">
          <thead>
            <tr>
              <th>Reg No</th>
              <th>Name</th>
              <th>Stream</th>
              <th>Form</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="studentsBody"></tbody>
        </table>
        <div id="editStudentForm" style="display: none; margin-top: 20px;">
          <h3 style="font-size: 20px; color: #333;">Edit Student</h3>
          <input id="editRegNo" type="text" disabled>
          <input id="editName" type="text" placeholder="Name" required>
          <input id="editPassword" type="password" placeholder="New Password">
          <select id="editForm" required>
            <option value="form1">Form 1</option>
            <option value="form2">Form 2</option>
            <option value="form3">Form 3</option>
            <option value="form4">Form 4</option>
          </select>
          <button onclick="saveStudentEdits()">Save Changes</button>
          <div id="editStudentMessage" class="error-message"></div>
        </div>
      </div>
      <div id="addStudent" class="section">
        <h1 style="font-size: 28px; color: #333;">Add Student</h1>
        <input id="newRegNo" type="text" placeholder="Reg No (e.g., AID/00119/025)" required>
        <input id="newName" type="text" placeholder="Name" required>
        <input id="newPassword" type="password" placeholder="Password" required>
        <select id="newForm" required>
          <option value="form1">Form 1</option>
          <option value="form2">Form 2</option>
          <option value="form3">Form 3</option>
          <option value="form4">Form 4</option>
        </select>
        <input id="newStream" type="text" placeholder="Stream (e.g., Victors)" required>
        <input id="newTotalFees" type="number" placeholder="Total Expected Fees (KES)" required>
        <button onclick="addStudent()">Add Student</button>
        <div id="addStudentMessage" class="error-message"></div>
      </div>
      <div id="marks" class="section">
        <h1 style="font-size: 28px; color: #333;">Upload Marks</h1>
        <select id="marksFormSelect" onchange="loadMarksForm()">
          <option value="form1">Form 1</option>
          <option value="form2">Form 2</option>
          <option value="form3">Form 3</option>
          <option value="form4">Form 4</option>
        </select>
        <select id="marksStudentSelect" onchange="updateMarksForm()"></select>
        <select id="termSelect" onchange="updateMarksForm()">
          <option value="term1">Term 1</option>
          <option value="term2">Term 2</option>
          <option value="term3">Term 3</option>
        </select>
        <div style="margin-bottom: 20px;">
          <label class="checkbox-label">
            <input type="checkbox" id="uploadCat" onchange="updateMarksForm()"> Upload CAT Marks
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="uploadExam" onchange="updateMarksForm()"> Upload Exam Marks
          </label>
        </div>
        <div id="existingMarks" style="margin-bottom: 20px;"></div>
        <div id="subjectSelection"></div>
        <div id="marksForm"></div>
        <button onclick="uploadMarks()">Upload Marks</button>
      </div>
      <div id="announcements" class="section">
        <h1 style="font-size: 28px; color: #333;">Announcements</h1>
        <select id="announcementType" onchange="loadAnnouncementForm()">
          <option value="general">General</option>
          <option value="individual">Individual</option>
        </select>
        <select id="announcementStudent" style="display: none;"></select>
        <input id="announcementTitle" type="text" placeholder="Title" required>
        <textarea id="announcementMessage" placeholder="Message" required></textarea>
        <button onclick="addAnnouncement()">Add Announcement</button>
      </div>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCi9NWfDwbWSByd_R7ueNkLcQsFlBJ5_VA",
      authDomain: "web-reg-cbf2f.firebaseapp.com",
      databaseURL: "https://web-reg-cbf2f-default-rtdb.firebaseio.com",
      projectId: "web-reg-cbf2f",
      storageBucket: "web-reg-cbf2f.firebasestorage.app",
      messagingSenderId: "431303341740",
      appId: "1:431303341740:web:542070e4c471cd7c8ad109",
      measurementId: "G-164GMVZQY3"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    const loadingScreen = document.getElementById("loadingScreen");

    auth.onAuthStateChanged(async user => {
      if (!user || sessionStorage.getItem("userType") !== "teacher") {
        sessionStorage.clear();
        window.location.href = "index.html";
      } else {
        try {
          console.log("Teacher.html loaded, sessionStorage:", sessionStorage.getItem("userType"), sessionStorage.getItem("username"), user.uid);
          const teacherEmail = sessionStorage.getItem("username") || "Teacher";
          const teacherName = teacherEmail.split("@")[0].replace(/\d/g, "");
          document.getElementById("teacherName").textContent = teacherName;
          loadingScreen.classList.add("hidden");
          await loadStudents();
          await loadMarksForm();
        } catch (error) {
          console.error("Auth state error:", error);
          showMessage("studentsMessage", `Failed to load: ${error.message}`);
        }
      }
    });

    const subjects = [
      "English", "Mathematics", "Kiswahili", "Biology", "Chemistry", "Physics",
      "History", "Geography", "CRE", "Business Studies", "Computer Studies"
    ];

    function showSection(section) {
      document.querySelectorAll(".section").forEach(div => div.classList.remove("active"));
      document.getElementById(section).classList.add("active");
    }

    function showMessage(elementId, message, isError = true) {
      const messageDiv = document.getElementById(elementId);
      messageDiv.textContent = message;
      messageDiv.style.color = isError ? "#ff4444" : "#00cc00";
      messageDiv.style.display = "block";
      setTimeout(() => messageDiv.style.display = "none", 3000);
    }

    function validateRegNo(regNo) {
      const invalidChars = /[.#$\[\]]/;
      return !invalidChars.test(regNo);
    }

    async function addStudent() {
      const regNo = document.getElementById("newRegNo").value.trim();
      const normalizedRegNo = regNo.replace(/\//g, "_");
      const name = document.getElementById("newName").value.trim();
      const password = document.getElementById("newPassword").value;
      const form = document.getElementById("newForm").value;
      const stream = document.getElementById("newStream").value.trim();
      const totalFees = parseInt(document.getElementById("newTotalFees").value);

      if (!regNo || !name || !password || !form || !stream || !totalFees) {
        showMessage("addStudentMessage", "All fields are required.");
        return;
      }

      if (!validateRegNo(normalizedRegNo)) {
        showMessage("addStudentMessage", "Invalid Reg No format. Avoid '.', '#', '$', '[', or ']'.");
        return;
      }

      try {
        const studentRef = db.ref("users/students/" + normalizedRegNo);
        const snapshot = await studentRef.once("value");
        if (snapshot.exists()) {
          showMessage("addStudentMessage", "Reg No already exists.");
          return;
        }

        const newStudent = {
          profile: { name, password },
          form,
          stream,
          fees: { totalExpected: totalFees, transactions: [] },
          academics: {}
        };
        await studentRef.set(newStudent);
        showMessage("addStudentMessage", "Student added successfully!", false);
        document.getElementById("newRegNo").value = "";
        document.getElementById("newName").value = "";
        document.getElementById("newPassword").value = "";
        document.getElementById("newStream").value = "";
        document.getElementById("newTotalFees").value = "";
        await loadStudents();
      } catch (error) {
        console.error("Add student error:", error);
        showMessage("addStudentMessage", `Failed to add student: ${error.message}`);
      }
    }

    async function loadStudents() {
      const form = document.getElementById("formSelect").value;
      const studentsBody = document.getElementById("studentsBody");
      studentsBody.innerHTML = "<tr><td colspan='5'>Loading...</td></tr>";

      try {
        const snapshot = await db.ref("users/students").once("value");
        const students = snapshot.val() || {};
        let studentsList = [];

        Object.keys(students).forEach(regNo => {
          const student = students[regNo];
          if (student.form === form) {
            studentsList.push({
              regNo,
              name: student.profile.name,
              stream: student.stream,
              form: student.form
            });
          }
        });

        studentsBody.innerHTML = "";
        if (studentsList.length === 0) {
          studentsBody.innerHTML = `<tr><td colspan="5">No students found in ${form}.</td></tr>`;
          return;
        }

        studentsList.sort((a, b) => a.regNo.localeCompare(b.regNo));
        studentsList.forEach(student => {
          studentsBody.innerHTML += `<tr>
            <td>${student.regNo}</td>
            <td>${student.name}</td>
            <td>${student.stream}</td>
            <td>${student.form}</td>
            <td><button class="edit-btn" onclick="editStudent('${student.regNo}', '${student.name}', '${student.form}')">Edit</button></td>
          </tr>`;
        });
      } catch (error) {
        console.error("Load students error:", error);
        studentsBody.innerHTML = `<tr><td colspan="5">Failed to load students: ${error.message}</td></tr>`;
        showMessage("studentsMessage", `Error: ${error.message}`);
      }
    }

    function editStudent(regNo, name, form) {
      const editForm = document.getElementById("editStudentForm");
      editForm.style.display = "block";
      document.getElementById("editRegNo").value = regNo;
      document.getElementById("editName").value = name;
      document.getElementById("editPassword").value = "";
      document.getElementById("editForm").value = form;
    }

    async function saveStudentEdits() {
      const regNo = document.getElementById("editRegNo").value;
      const normalizedRegNo = regNo.replace(/\//g, "_");
      const name = document.getElementById("editName").value.trim();
      const password = document.getElementById("editPassword").value;
      const form = document.getElementById("editForm").value;

      if (!name || !form) {
        showMessage("editStudentMessage", "Name and Form are required.");
        return;
      }

      try {
        const updates = { profile: { name }, form };
        if (password) updates.profile.password = password;

        await db.ref(`users/students/${normalizedRegNo}`).update(updates);
        showMessage("editStudentMessage", "Student updated successfully!", false);
        document.getElementById("editStudentForm").style.display = "none";
        await loadStudents();
      } catch (error) {
        console.error("Save student edits error:", error);
        showMessage("editStudentMessage", `Failed to update student: ${error.message}`);
      }
    }

    function loadMarksForm() {
      const formSelect = document.getElementById("marksFormSelect");
      const studentSelect = document.getElementById("marksStudentSelect");
      studentSelect.innerHTML = "<option>Loading...</option>";
      const form = formSelect.value;

      db.ref("users/students").once("value", (snapshot) => {
        const students = snapshot.val() || {};
        let studentsList = [];

        Object.keys(students).forEach(regNo => {
          const student = students[regNo];
          if (student.form === form) {
            studentsList.push({
              regNo,
              name: student.profile.name,
              stream: student.stream
            });
          }
        });

        studentSelect.innerHTML = "";
        if (studentsList.length === 0) {
          studentSelect.innerHTML = `<option value="">No students found in ${form}.</option>`;
          document.getElementById("subjectSelection").innerHTML = "";
          document.getElementById("marksForm").innerHTML = "<p>No students available to upload marks for.</p>";
          document.getElementById("existingMarks").innerHTML = "";
          return;
        }

        studentsList.sort((a, b) => a.regNo.localeCompare(b.regNo));
        studentSelect.innerHTML = `<option value="">Select a student</option>`;
        studentsList.forEach(student => {
          studentSelect.innerHTML += `<option value="${student.regNo}|${student.stream}">${student.name} (${student.regNo})</option>`;
        });

        updateMarksForm();
      }).catch(error => {
        document.getElementById("marksForm").innerHTML = `<div class="error-message">Failed to load marks form: ${error.message}</div>`;
      });
    }

    function updateMarksForm() {
      const uploadCat = document.getElementById("uploadCat").checked;
      const uploadExam = document.getElementById("uploadExam").checked;
      const term = document.getElementById("termSelect").value;
      const studentSelect = document.getElementById("marksStudentSelect");
      const subjectSelection = document.getElementById("subjectSelection");
      const marksForm = document.getElementById("marksForm");
      const existingMarksDiv = document.getElementById("existingMarks");

      subjectSelection.innerHTML = "";
      marksForm.innerHTML = "";
      existingMarksDiv.innerHTML = "";

      if (!studentSelect.value || studentSelect.value === "") {
        marksForm.innerHTML = "<p>Please select a student to upload marks for.</p>";
        return;
      }

      if (!uploadCat && !uploadExam) {
        marksForm.innerHTML = "<p>Please select at least one type of marks to upload (CAT or Exam).</p>";
        return;
      }

      const [regNo] = studentSelect.value.split("|");
      const normalizedRegNo = regNo.replace(/\//g, "_");
      db.ref(`users/students/${normalizedRegNo}/academics/${term}`).once("value", snapshot => {
        const marksData = snapshot.val() || {};
        let marksHTML = "<h3 style='font-size: 18px; color: #333;'>Existing Marks</h3>";
        if (marksData.cat || marksData.exam) {
          marksHTML += "<table><thead><tr><th>Subject</th><th>CAT</th><th>Exam</th></tr></thead><tbody>";
          subjects.forEach(subject => {
            const cat = marksData.cat?.[subject] || "-";
            const exam = marksData.exam?.[subject] || "-";
            marksHTML += `<tr><td>${subject}</td><td>${cat}</td><td>${exam}</td></tr>`;
          });
          marksHTML += "</tbody></table>";
        } else {
          marksHTML += "<p>No marks recorded for this term.</p>";
        }
        existingMarksDiv.innerHTML = marksHTML;
      }).catch(error => {
        existingMarksDiv.innerHTML = `<div class="error-message">Error loading marks: ${error.message}</div>`;
      });

      let subjectHtml = "<h3 style='font-size: 20px; margin-bottom: 15px; color: #333;'>Select Subjects</h3>";
      subjects.forEach(subject => {
        subjectHtml += `
          <label class="checkbox-label">
            <input type="checkbox" id="subject_${subject}" onchange="renderMarksInputs()"> ${subject}
          </label>`;
      });
      subjectSelection.innerHTML = subjectHtml;

      renderMarksInputs();
    }

    function renderMarksInputs() {
      const uploadCat = document.getElementById("uploadCat").checked;
      const uploadExam = document.getElementById("uploadExam").checked;
      const term = document.getElementById("termSelect").value;
      const studentSelect = document.getElementById("marksStudentSelect");
      const marksForm = document.getElementById("marksForm");
      marksForm.innerHTML = "";

      if (!studentSelect.value || studentSelect.value === "") {
        marksForm.innerHTML = "<p>Please select a student to upload marks for.</p>";
        return;
      }

      if (!uploadCat && !uploadExam) {
        marksForm.innerHTML = "<p>Please select at least one type of marks to upload (CAT or Exam).</p>";
        return;
      }

      const selectedSubjects = subjects.filter(subject => document.getElementById(`subject_${subject}`).checked);

      if (selectedSubjects.length === 0) {
        marksForm.innerHTML = "<p>Please select at least one subject to upload marks for.</p>";
        return;
      }

      if (uploadCat && term !== "term3") {
        marksForm.innerHTML += "<h3 style='font-size: 20px; margin-bottom: 15px; color: #333;'>CAT</h3>";
        selectedSubjects.forEach(subject => {
          marksForm.innerHTML += `<div style="margin-bottom: 15px;">
            <label style="display: block; font-size: 16px; color: #333;">${subject}</label>
            <input type="number" id="cat_${subject}" placeholder="Enter CAT marks" min="0" max="100">
          </div>`;
        });
      }
      if (uploadExam) {
        marksForm.innerHTML += `<h3 style='font-size: 20px; margin-bottom: 15px; color: #333;'>${term === "term3" ? "Final Exam" : "Exam"}</h3>`;
        selectedSubjects.forEach(subject => {
          marksForm.innerHTML += `<div style="margin-bottom: 15px;">
            <label style="display: block; font-size: 16px; color: #333;">${subject}</label>
            <input type="number" id="exam_${subject}" placeholder="Enter Exam marks" min="0" max="100">
          </div>`;
        });
      }
    }

    function uploadMarks() {
      const studentSelect = document.getElementById("marksStudentSelect");
      if (!studentSelect.value) {
        alert("Please select a student to upload marks for.");
        return;
      }

      const [regNo] = studentSelect.value.split("|");
      const normalizedRegNo = regNo.replace(/\//g, "_");
      const term = document.getElementById("termSelect").value;
      const uploadCat = document.getElementById("uploadCat").checked;
      const uploadExam = document.getElementById("uploadExam").checked;

      const selectedSubjects = subjects.filter(subject => document.getElementById(`subject_${subject}`).checked);

      if (selectedSubjects.length === 0) {
        alert("Please select at least one subject to upload marks for.");
        return;
      }

      const marks = {};
      if (uploadCat && term !== "term3") {
        marks.cat = {};
        selectedSubjects.forEach(subject => {
          const catMarks = document.getElementById(`cat_${subject}`).value;
          if (catMarks) marks.cat[subject] = parseInt(catMarks);
        });
      }
      if (uploadExam) {
        marks.exam = {};
        selectedSubjects.forEach(subject => {
          const examMarks = document.getElementById(`exam_${subject}`).value;
          if (examMarks) marks.exam[subject] = parseInt(examMarks);
        });
      }

      if (Object.keys(marks.cat || {}).length === 0 && Object.keys(marks.exam || {}).length === 0) {
        alert("Please enter at least one mark.");
        return;
      }

      db.ref(`users/students/${normalizedRegNo}/academics/${term}`).update(marks)
        .then(() => {
          alert("Marks uploaded successfully!");
          loadMarksForm();
        })
        .catch(error => {
          alert("Failed to upload marks: " + error.message);
        });
    }

    function loadAnnouncementForm() {
      const typeSelect = document.getElementById("announcementType");
      const studentSelect = document.getElementById("announcementStudent");
      studentSelect.style.display = typeSelect.value === "individual" ? "block" : "none";
      if (typeSelect.value !== "individual") return;

      studentSelect.innerHTML = "<option>Loading...</option>";
      db.ref("users/students").once("value", (snapshot) => {
        const students = snapshot.val() || {};
        let studentsList = [];

        Object.keys(students).forEach(regNo => {
          const student = students[regNo];
          studentsList.push({ regNo, name: student.profile.name });
        });

        studentSelect.innerHTML = "";
        if (studentsList.length === 0) {
          studentSelect.innerHTML = `<option value="">No students found.</option>`;
          return;
        }

        studentsList.sort((a, b) => a.regNo.localeCompare(b.regNo));
        studentsList.forEach(student => {
          studentSelect.innerHTML += `<option value="${student.regNo}">${student.name} (${student.regNo})</option>`;
        });
      }).catch(error => {
        studentSelect.innerHTML = `<option>Failed to load students: ${error.message}</option>`;
      });
    }

    function addAnnouncement() {
      const type = document.getElementById("announcementType").value;
      const title = document.getElementById("announcementTitle").value.trim();
      const message = document.getElementById("announcementMessage").value.trim();

      if (!title || !message) {
        alert("Please enter both title and message.");
        return;
      }

      const announcement = {
        title,
        message,
        date: new Date().toISOString().split("T")[0],
        teacher: document.getElementById("teacherName").textContent
      };

      if (type === "general") {
        db.ref("announcements/general").push(announcement)
          .then(() => {
            alert("Announcement added successfully!");
            document.getElementById("announcementTitle").value = "";
            document.getElementById("announcementMessage").value = "";
          })
          .catch(error => {
            alert("Failed to add announcement: " + error.message);
          });
      } else {
        const regNo = document.getElementById("announcementStudent").value;
        if (!regNo) {
          alert("Please select a student for individual announcement.");
          return;
        }
        const normalizedRegNo = regNo.replace(/\//g, "_");
        db.ref(`announcements/individual/${normalizedRegNo}`).push(announcement)
          .then(() => {
            alert("Announcement added successfully!");
            document.getElementById("announcementTitle").value = "";
            document.getElementById("announcementMessage").value = "";
          })
          .catch(error => {
            alert("Failed to add announcement: " + error.message);
          });
      }
    }

    function logout() {
      auth.signOut().then(() => {
        sessionStorage.clear();
        window.location.href = "index.html";
      }).catch(error => {
        console.error("Logout failed:", error);
        alert("Failed to log out: " + error.message);
      });
    }
  </script>
</body>
</html>